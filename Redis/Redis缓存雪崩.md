## 缓存雪崩

缓存雪崩出现的原因是同一时间内大量的key同时失效或者Redis服务宕机，导致所有的请求都到数据库，数据库压力过大宕机。

根据产生雪崩的原因进行分析

> key同时失效导致的雪崩

我们在做缓存预热时和添加缓存时，设置有效期的同时，额外的增加（1~3）的随机过期时间。

同时当key过期后，构建缓存，利用互斥锁构建缓存，防止数据库压力过大。

> Redis服务宕机

利用Redis集群提高服务的可用性。

* 哨兵模式
* 集群模式

> 其他

给业务添加多级缓存， 如Guava或者Caffeine.

使用服务熔断或请求限流机制

我们可以启动**服务熔断**机制，**暂停业务应用对缓存服务的访问，直接返回错误**，不用再继续访问数据库，从而降低对数据库的访问压力，保证数据库系统的正常运行，然后等到 Redis 恢复正常后，再允许业务应用访问缓存服务。

但是这样在Redis服务宕机期间所有的业务都不可用，为了减少对业务的影响，可以启用**请求限流**机制，只将少部分请求发送到数据库，

更多的请求就只能拒绝服务，等Redis服务正常后并缓存预热完成在解除**请求限流机制**。