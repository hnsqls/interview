## 缓存击穿

缓存击穿是指在高并发的情况下，当某个**热点数据的缓存突然失效**（过期或被删除）并且**缓存重建业务较复杂**，大量请求直接穿透到后端数据库，导致数据库负载过高，甚至崩溃的问题。由于并发用户特别多，同时读缓存没读到数据，又去数据库中取数据，引起数据库压力瞬间增大。

解决方法：互斥锁构建缓存和逻辑过期时间

> 互斥锁构建缓存

在热点key失效后，加锁，确保只有一个线程查询数据库并构建缓存。其他的线程等待并重试在缓存中取值。

优点

* 一致性高

缺点

* 由于使用了锁，线程等待，性能低，还可以能出现死锁。





> 逻辑过期时间

对热点key不设置过期时间，仅仅添加个expire 字段。

当使用该缓存时，根据过期字段判断是否更新缓存，若在期限内就直接使用改缓存，若不在期限内就更新缓存。

更新缓存的具体细节，利用锁确保一个线程重构缓存，防止数据库压力过大。在获得锁后，异步执行，新开线程执行重构缓存，同时原线程直接使用已经过期的数据。在此期间其他线程也发现缓存逻辑过期了，也会获得锁，但是获取锁失败，那就使用原来的老数据。

优点

* 性能高

缺点

* 数据不一致